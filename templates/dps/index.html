{% extends 'auth.html' %}

{% load dulsine_extras %}

{% block titre %}{{ structure.nom }} - DPS{% endblock %}

{% block breadcrumb %}
<ul class="breadcrumb">
  <li><a href="{% url 'index' %}">Accueil</a> <span class="divider">/</span></li>
  <li><a href="#">Événements</a> <span class="divider">/</span></li>
  <li class="active">DPS</li>
</ul>
{% endblock %}

{% block corps %}
<div class="page-header">
  <h1>Liste des DPS <small>Inscription</small></h1>
</div>

<div class="row">
{% regroup all_dim by debut|date:"F o" as all_dim_by_months %}
{% for month in all_dim_by_months %}

<div class="span12">
<h4>{{ month.grouper|capfirst }}</h4>
<table class="table table-striped">
<thead>
<tr>
 <th width="10%">Date</th>
 <th width="10%">Horaire</th>
 <th width="50%">Nom</th>
 <th width="10%">Status</th>
 <th width="5%">CI</th>
 <th width="5%">PSE2</th>
 <th width="5%">PSE1</th>
 <th width="5%">PSC1</th>
</tr>
</thead>

{% for dim in month.list %}
<tr id="{{ dim.id }}">
  <td>{{ dim.debut|date:"D d"|capfirst }}</td>
  <td>{{ dim.debut|date:"H:i" }} - {{ dim.fin|date:"H:i" }}</td>
  <td><a href="{% url 'dps.dimensionnement.details' dim.DPS.structure.pk dim.id %}">{{ dim }}</a></td>
  <td>{% label dim.id user.id %}</td>
  <td>{% badge dim.id 0 %}</td>
  <td>{% badge dim.id 1 %}</td>
  <td>{% badge dim.id 2 %}</td>
  <td>{% badge dim.id 3 %}</td>
</tr>
{% endfor %}
</table>
</div>

{% endfor %}
</div>
{% endblock %}

{% block script %}
<script>
  var function_names = { "CI": 0, "PSE2": 1, "PSE1": 2, "PSC1": 3}
  $("span.badge").click(function(event) {
    $.getJSON($(this).attr("dim-id") + "/inscription/" + $(this).attr("function-id")).done(function(response) {
      if(response.fonction in function_names) {
        $("tr#" + response.dim + " > td > span.label").replaceWith("<span class=\"label label-warning\">" + response.fonction + " ?</span>")
      }
    })
  })
</script>
{% endblock %}
